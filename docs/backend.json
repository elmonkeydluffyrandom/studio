
{
  "entities": {
    "BibliaDiarioEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BibliaDiarioEntry",
      "type": "object",
      "description": "Represents a single entry in the BibliaDiario application, containing the Bible verse, observation, teaching, practical application, and associated tags.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the BibliaDiarioEntry entity."
        },
        "bibleVerse": {
          "type": "string",
          "description": "The Bible verse reference (e.g., Psalms 23)."
        },
        "verseText": {
          "type": "string",
          "description": "The text of the Bible verse (Reina Valera 1960)."
        },
        "observation": {
          "type": "string",
          "description": "Contextual observations and relevant facts related to the verse."
        },
        "teaching": {
          "type": "string",
          "description": "Theological interpretation and teaching derived from the verse."
        },
        "practicalApplication": {
          "type": "string",
          "description": "Personal commitments and practical applications of the teaching."
        },
        "tagIds": {
          "type": "array",
          "description": "References to Tag. (Relationship: BibliaDiarioEntry N:N Tag)",
          "items": {
            "type": "string"
          }
        },
        "creationTimestamp": {
          "type": "string",
          "description": "Timestamp of when the entry was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "bibleVerse",
        "verseText",
        "observation",
        "teaching",
        "practicalApplication",
        "creationTimestamp"
      ]
    },
    "Tag": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tag",
      "type": "object",
      "description": "Represents a tag that can be associated with BibliaDiario entries.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Tag entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the tag (e.g., Oraci√≥n, Familia)."
        }
      },
      "required": [
        "id",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/entries/{entryId}",
        "definition": {
          "entityName": "BibliaDiarioEntry",
          "schema": {
            "$ref": "#/backend/entities/BibliaDiarioEntry"
          },
          "description": "Stores BibliaDiario entries for each user. Path-based ownership ensures only the authenticated user can access their entries.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "entryId",
              "description": "The unique identifier for the BibliaDiario entry."
            }
          ]
        }
      },
      {
        "path": "/tags/{tagId}",
        "definition": {
          "entityName": "Tag",
          "schema": {
            "$ref": "#/backend/entities/Tag"
          },
          "description": "Stores global tags available to all users. This collection is globally readable, but only admins can create/update/delete tags (this needs to be managed through a dedicated admin role, existence over content).",
          "params": [
            {
              "name": "tagId",
              "description": "The unique identifier for the tag."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a secure and scalable solution for the BibliaDiario application. The structure uses path-based ownership for user-specific data and denormalization to avoid using `get()` calls in security rules, ensuring authorization independence. This allows for atomic operations and easier debugging.\n\nThe core structure centers around the `users/{userId}` collection. Each user owns their `BibliaDiarioEntry` documents within a subcollection. This allows for simple and efficient security rules based on the user's `uid`.  The `tagIds` are stored directly on the `BibliaDiarioEntry` document. This facilitates querying and listing entries efficiently.\n\nQAPs are supported through structural segregation and path-based ownership.  Listing operations are secured by scoping them to the user's specific collection (`users/{userId}/entries`). The security rules will ensure that only the authenticated user can access their own entries. This approach allows for efficient and secure `list` operations without complex filtering within the rules."
  }
}
